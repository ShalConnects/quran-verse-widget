<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Daily Quran Verse Widget</title>
    <link rel="icon" href="favicon.ico" type="image/x-icon">
    
    <meta name="description" content="Beautiful daily Quran verses with Arabic text and English translations. Features dark mode, mobile gestures, and social sharing.">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lexend+Deca:wght@100..900&family=Quicksand:wght@300..700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.6.0/css/all.min.css" integrity="sha512-Kc323vGBEqzTmouAECnVceyQqyqdsSiqLQISBL29aUW4U/M7pSPA/gEUZQqv1cwx4OnYxTxve5UMg5GT6L4JJg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
.grid_container {
    background: linear-gradient(135deg, #f5f5f5 0%, #f8f9fa 100%);
    border: 1px solid #ddd;
    border-radius: 8px;
    max-width: 500px;
    width: 100%;
    padding: 20px;
    margin: 20px auto;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
}

.grid_container::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: radial-gradient(circle at 20% 80%, rgba(203, 165, 13, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(203, 165, 13, 0.1) 0%, transparent 50%);
    pointer-events: none;
    z-index: 0;
}

.grid_container > * {
    position: relative;
    z-index: 1;
}

.moon {
  width: 50px;
  margin: 0 auto;
  display: block;
  animation: customAni1 2s ease 0s infinite normal none;
  cursor: pointer;
  transition: transform 0.3s ease;
  border-radius: 50%;
}

.moon:hover {
  transform: scale(1.1);
}

@keyframes customAni3 {
  0%,
  50%,
  100% {
	opacity: 1;
  }

  25%,
  75% {
	opacity: 0;
  }
}

@keyframes customAni2 {
  0%,
  100% {
	transform: translateY(0) rotate(0);
	transform-origin: 50% 50%;
  }

  15% {
	transform: translateY(-30px) rotate(-6deg);
  }

  30% {
	transform: translateY(15px) rotate(6deg);
  }

  45% {
	transform: translateY(-15px) rotate(-3.6deg);
  }

  60% {
	transform: translateY(9px) rotate(2.4deg);
  }

  75% {
	transform: translateY(-6px) rotate(-1.2deg);
  }
}

@keyframes customAni1 {
  0% {
	transform: translate(0);
  }

  20% {
	transform: translate(-2px, 2px);
  }

  40% {
	transform: translate(-2px, -2px);
  }

  60% {
	transform: translate(2px, 2px);
  }

  80% {
	transform: translate(2px, -2px);
  }

  100% {
	transform: translate(0);
  }
}

#quranVerse {
    font-family: "Lexend Deca", sans-serif;
    text-align: center;
    line-height: 1.6;
}

.verse-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 10px;
    margin-bottom: 20px;
    padding: 10px 15px;
    background: rgba(203, 165, 13, 0.1);
    border-radius: 8px;
    border-left: 4px solid #cba50d;
}

.surah-info {
    font-size: 14px;
    font-weight: 600;
    color: #cba50d;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.ayah-number {
    font-size: 14px;
    font-weight: 600;
    color: #2c3e50;
    background: rgba(44, 62, 80, 0.1);
    padding: 4px 8px;
    border-radius: 12px;
}

.arabic-text {
    font-size: 32px;
    font-weight: 600;
    margin-bottom: 20px;
    color: #2c3e50;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

.english-text {
    font-size: 18px;
    font-weight: 400;
    margin-bottom: 15px;
    color: #34495e;
    line-height: 1.5;
}

/* Dark mode styles for verse elements */
body.dark-mode .verse-header {
    background: rgba(203, 165, 13, 0.2);
    border-left-color: #cba50d;
}

body.dark-mode .surah-info {
    color: #cba50d;
}

body.dark-mode .ayah-number {
    color: #ecf0f1;
    background: rgba(236, 240, 241, 0.1);
}

body.dark-mode .arabic-text {
    color: #ecf0f1;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

body.dark-mode .english-text {
    color: #bdc3c7;
}

.verse-actions {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin: 15px 0;
    flex-wrap: wrap;
    position: relative;
}

.action-button {
    font-family: "Lexend Deca", sans-serif;
    padding: 10px 12px;
    font-size: 14px;
    color: #fff;
    background-color: #6c757d;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-align: center;
    transition: all 0.3s ease;
    min-width: 44px;
    min-height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
}

.action-button:hover {
    background-color: #cba50d;
    color: #000;
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
}

.action-button.primary {
    background-color: #007bff;
}

.action-button.primary:hover {
    background-color: #0056b3;
}

.action-button.favorited {
    background-color: #e74c3c;
    color: #fff;
}

.action-button.favorited:hover {
    background-color: #c0392b;
}

.share-menu {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background: white;
    border: 3px solid #e74c3c;
    border-radius: 8px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.5);
    z-index: 10000;
    min-width: 200px;
    display: none;
    opacity: 1;
}

.share-option {
    display: block;
    width: 100%;
    padding: 12px 16px;
    border: none;
    background: none;
    text-align: left;
    cursor: pointer;
    transition: background-color 0.2s ease;
    font-family: "Lexend Deca", sans-serif;
    font-size: 14px;
}

.share-option:hover {
    background-color: #f8f9fa;
}

.share-option i {
    margin-right: 8px;
    width: 16px;
}

/* Dark mode styles for new elements */
body.dark-mode .share-menu {
    background: #2d2d2d;
    border-color: #444;
}

body.dark-mode .share-option {
    color: #e0e0e0;
}

body.dark-mode .share-option:hover {
    background-color: #3d3d3d;
}


/* Skeleton Loading Styles */
.skeleton-loader {
    animation: skeleton-fade-in 0.3s ease-in-out;
}

.skeleton-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 10px 15px;
    background: rgba(203, 165, 13, 0.1);
    border-radius: 8px;
    border-left: 4px solid #cba50d;
}

.skeleton-line {
    height: 16px;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s infinite;
    border-radius: 4px;
}

.skeleton-surah {
    width: 120px;
    height: 14px;
}

.skeleton-badge {
    width: 60px;
    height: 24px;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s infinite;
    border-radius: 12px;
}

.skeleton-text {
    height: 20px;
    background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
    background-size: 200% 100%;
    animation: skeleton-shimmer 1.5s infinite;
    border-radius: 4px;
    margin-bottom: 15px;
}

.skeleton-arabic {
    height: 32px;
    margin-bottom: 20px;
}

.skeleton-arabic:first-of-type {
    width: 90%;
}

.skeleton-arabic:nth-of-type(2) {
    width: 75%;
    margin-left: auto;
    margin-right: 0;
}

.skeleton-english {
    height: 18px;
    margin-bottom: 12px;
}

.skeleton-english:first-of-type {
    width: 95%;
}

.skeleton-english:nth-of-type(2) {
    width: 85%;
}

.skeleton-english:nth-of-type(3) {
    width: 70%;
}

/* Skeleton Animations */
@keyframes skeleton-shimmer {
    0% {
        background-position: -200% 0;
    }
    100% {
        background-position: 200% 0;
    }
}

@keyframes skeleton-fade-in {
    0% {
        opacity: 0;
        transform: translateY(10px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

/* Dark mode skeleton styles */
body.dark-mode .skeleton-header {
    background: rgba(203, 165, 13, 0.2);
    border-left-color: #cba50d;
}

body.dark-mode .skeleton-line,
body.dark-mode .skeleton-badge,
body.dark-mode .skeleton-text {
    background: linear-gradient(90deg, #3d3d3d 25%, #4a4a4a 50%, #3d3d3d 75%);
    background-size: 200% 100%;
}

/* Mobile skeleton adjustments */
@media (max-width: 768px) {
    .skeleton-header {
        margin-bottom: 15px;
        padding: 8px 12px;
    }
    
    .skeleton-surah {
        width: 100px;
        height: 12px;
    }
    
    .skeleton-badge {
        width: 50px;
        height: 20px;
    }
    
    .skeleton-arabic {
        height: 26px;
        margin-bottom: 18px;
    }
    
    .skeleton-english {
        height: 16px;
        margin-bottom: 10px;
    }
}

@media (max-width: 480px) {
    .skeleton-arabic {
        height: 22px;
        margin-bottom: 15px;
    }
    
    .skeleton-english {
        height: 15px;
        margin-bottom: 8px;
    }
}

kbd {
    background-color: #f4f4f4;
    border: 1px solid #ccc;
    border-radius: 3px;
    box-shadow: 0 1px 0 rgba(0,0,0,0.2);
    color: #333;
    display: inline-block;
    font-size: 11px;
    font-weight: bold;
    line-height: 1;
    padding: 2px 4px;
    white-space: nowrap;
}

.header-controls {
    display: flex;
    justify-content: flex-end;
    margin-bottom: 10px;
}

.dark-mode-toggle {
    background: none;
    border: 2px solid #ddd;
    border-radius: 50%;
    width: 40px;
    height: 40px;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 16px;
    color: #666;
    transition: all 0.3s ease;
}

.dark-mode-toggle:hover {
    border-color: #cba50d;
    color: #cba50d;
    transform: scale(1.1);
}

/* Dark mode styles */
body.dark-mode {
    background-color: #1a1a1a;
    color: #e0e0e0;
}

body.dark-mode .grid_container {
    background: linear-gradient(135deg, #2d2d2d 0%, #1a1a1a 100%);
    border-color: #444;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
}

body.dark-mode .grid_container::before {
    background: radial-gradient(circle at 20% 80%, rgba(203, 165, 13, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(203, 165, 13, 0.2) 0%, transparent 50%);
}

body.dark-mode #quranVerse p:nth-child(1) {
    color: #ecf0f1;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
}

body.dark-mode #quranVerse p:nth-child(2) {
    color: #bdc3c7;
}

body.dark-mode #quranVerse p:nth-child(3) {
    color: #95a5a6;
}

body.dark-mode .action-button {
    background-color: #4a4a4a;
    color: #e0e0e0;
}

body.dark-mode .action-button:hover {
    background-color: #cba50d;
    color: #000;
}

body.dark-mode .action-button.primary {
    background-color: #0056b3;
}

body.dark-mode .action-button.primary:hover {
    background-color: #003d82;
}

body.dark-mode .dark-mode-toggle {
    border-color: #666;
    color: #e0e0e0;
}

body.dark-mode .dark-mode-toggle:hover {
    border-color: #cba50d;
    color: #cba50d;
}

body.dark-mode p {
    color: #999 !important;
}

body.dark-mode kbd {
    background-color: #444;
    border-color: #666;
    color: #e0e0e0;
}

/* Mobile-specific improvements */
@media (max-width: 768px) {
    .grid_container {
        margin: 0;
        padding: 15px;
        border-radius: 8px;
        max-width: none;
        width: 100vw;
        box-sizing: border-box;
    }
    
    body {
        margin: 0;
        padding: 0;
    }
    
    .moon {
        width: 40px;
        margin-bottom: 15px;
    }
    
    .verse-header {
        margin-bottom: 15px;
        padding: 8px 12px;
    }
    
    .surah-info, .ayah-number {
        font-size: 12px;
    }
    
    .arabic-text {
        font-size: 26px;
        line-height: 1.4;
        margin-bottom: 18px;
    }
    
    .english-text {
        font-size: 16px;
        line-height: 1.5;
        margin-bottom: 12px;
    }
    
    .verse-actions {
        gap: 8px;
        margin: 12px 0;
    }
    
    .action-button {
        padding: 12px 14px;
        font-size: 16px;
        min-height: 44px; /* iOS touch target minimum */
        min-width: 44px;
    }
    
    .dark-mode-toggle {
        width: 44px;
        height: 44px;
        font-size: 18px;
    }
    
    .header-controls {
        margin-bottom: 15px;
    }
    
    /* Improve touch targets */
    button {
        -webkit-tap-highlight-color: rgba(203, 165, 13, 0.3);
    }
    
    /* Better spacing for mobile */
    p {
        margin: 8px 0;
    }
    
    /* Pull-to-refresh visual feedback */
    .grid_container {
        transition: transform 0.2s ease, opacity 0.2s ease;
    }
    
    /* Mobile refresh button animation */
    #refreshButton:active {
        transform: scale(0.95);
        transition: transform 0.1s ease;
    }
    
    /* Mobile dark mode toggle animation */
    .dark-mode-toggle:active {
        transform: scale(0.9);
        transition: transform 0.1s ease;
    }
    
    /* Haptic feedback simulation */
    @keyframes mobileTap {
        0% { transform: scale(1); }
        50% { transform: scale(0.95); }
        100% { transform: scale(1); }
    }
    
    .mobile-tap {
        animation: mobileTap 0.2s ease;
    }
}

/* Very small screens */
@media (max-width: 480px) {
    .grid_container {
        margin: 0;
        padding: 12px;
        border-radius: 8px;
        max-width: none;
        width: 100vw;
        box-sizing: border-box;
    }
    
    body {
        margin: 0;
        padding: 0;
    }
    
    .arabic-text {
        font-size: 22px;
        margin-bottom: 15px;
    }
    
    .english-text {
        font-size: 15px;
        margin-bottom: 10px;
    }
    
    .verse-header {
        margin-bottom: 12px;
        padding: 6px 10px;
    }
    
    .surah-info, .ayah-number {
        font-size: 11px;
    }
    
    .moon {
        width: 35px;
    }
}

/* Landscape mobile orientation */
@media (max-width: 768px) and (orientation: landscape) {
    .grid_container {
        margin: 0;
        padding: 10px;
        border-radius: 0;
        max-width: none;
        width: 100vw;
        box-sizing: border-box;
    }
    
    body {
        margin: 0;
        padding: 0;
    }
    
    .moon {
        width: 35px;
        margin-bottom: 10px;
    }
    
    .arabic-text {
        font-size: 24px;
        margin-bottom: 12px;
    }
    
    .english-text {
        font-size: 16px;
        margin-bottom: 10px;
    }
    
    .verse-header {
        margin-bottom: 10px;
        padding: 6px 10px;
    }
    
    .surah-info, .ayah-number {
        font-size: 11px;
    }
}
    </style>
</head>
<body>
<div class="grid_container">
<div class="header-controls">
    <button id="darkModeToggle" class="dark-mode-toggle" title="Toggle dark mode">
        <i class="fa-solid fa-moon"></i>
    </button>
</div>
<img src="moon.png" class="moon">
<div id="quranVerse" class="item-a">Loading verse...</div>

<!-- Skeleton Loading State -->
<div id="skeletonLoader" class="skeleton-loader" style="display: none;">
    <div class="skeleton-header">
        <div class="skeleton-line skeleton-surah"></div>
        <div class="skeleton-badge"></div>
    </div>
    <div class="skeleton-text skeleton-arabic"></div>
    <div class="skeleton-text skeleton-arabic"></div>
    <div class="skeleton-text skeleton-english"></div>
    <div class="skeleton-text skeleton-english"></div>
    <div class="skeleton-text skeleton-english"></div>
</div>

<div class="verse-actions">
    <button id="refreshButton" class="action-button primary"><i class="fa-solid fa-rotate-right"></i></button>
    <button id="copyButton" class="action-button" title="Copy verse"><i class="fa-solid fa-copy"></i></button>
    <button id="favoriteButton" class="action-button" title="Add to favorites"><i class="fa-solid fa-heart"></i></button>
    <button id="shareButton" class="action-button" title="Share verse"><i class="fa-solid fa-share"></i></button>
</div>

<div id="shareMenu" class="share-menu" style="display: none;">
    <button class="share-option" data-platform="twitter"><i class="fa-brands fa-twitter"></i> Twitter</button>
    <button class="share-option" data-platform="facebook"><i class="fa-brands fa-facebook"></i> Facebook</button>
    <button class="share-option" data-platform="whatsapp"><i class="fa-brands fa-whatsapp"></i> WhatsApp</button>
    <button class="share-option" data-platform="telegram"><i class="fa-brands fa-telegram"></i> Telegram</button>
</div>

<p style="text-align: center; font-size: 12px; color: #666; margin-top: 10px; font-family: 'Lexend Deca', sans-serif;">
    <i class="fa-solid fa-keyboard"></i> Press <kbd>Space</kbd> to refresh • <kbd>D</kbd> for dark mode • <kbd>I</kbd> to change icon • <kbd>C</kbd> to copy
</p>
</div>


    <script>
        // Constants
        const CACHE_DURATION = 24 * 60 * 60 * 1000; // 24 hours in milliseconds
        const API_URL = 'https://api.alquran.cloud/v1/ayah/random/editions/quran-simple,en.sahih';
        const STORAGE_KEYS = {
            LAST_FETCHED_TIME: 'lastFetchedTime',
            SAVED_AYAH: 'savedAyah',
            DARK_MODE: 'darkMode',
            SELECTED_ICON: 'selectedIcon',
            FAVORITES: 'favoriteVerses',
            CURRENT_VERSE_DATA: 'currentVerseData'
        };

        // Available icons
        const AVAILABLE_ICONS = [
            'moon.png',
            'icon-1.png',
            'icon-2.png',
            'icon-3.png',
            'icon-4.png',
            'icon-5.png'
        ];

        // DOM elements
        const verseElement = document.getElementById('quranVerse');
        const skeletonLoader = document.getElementById('skeletonLoader');
        const refreshButton = document.getElementById('refreshButton');
        const copyButton = document.getElementById('copyButton');
        const favoriteButton = document.getElementById('favoriteButton');
        const shareButton = document.getElementById('shareButton');
        const shareMenu = document.getElementById('shareMenu');
        const darkModeToggle = document.getElementById('darkModeToggle');
        const body = document.body;
        const gridContainer = document.querySelector('.grid_container');
        const moonIcon = document.querySelector('.moon');
        
        // Current verse data
        let currentVerseData = null;
        
        
        // Touch gesture variables
        let touchStartY = 0;
        let touchEndY = 0;
        let isPulling = false;
        let pullDistance = 0;
        
async function fetchVerse(forceRefresh = false) {
            const lastFetchedTime = localStorage.getItem(STORAGE_KEYS.LAST_FETCHED_TIME);
            const storedAyah = localStorage.getItem(STORAGE_KEYS.SAVED_AYAH);

    // Fetch a new ayah if 24 hours have passed or if forceRefresh is true
    // Also fetch a new ayah if there is no stored ayah on first load
            if (!forceRefresh && storedAyah && lastFetchedTime && Date.now() - lastFetchedTime < CACHE_DURATION) {
                verseElement.innerHTML = JSON.parse(storedAyah);
                
                // Try to load verse data from localStorage first
                const storedVerseData = localStorage.getItem(STORAGE_KEYS.CURRENT_VERSE_DATA);
                if (storedVerseData) {
                    currentVerseData = JSON.parse(storedVerseData);
                } else {
                    // Fallback: extract from cached content
                    extractVerseDataFromCachedContent();
                }
                
                updateFavoriteButton();
        return;
    }

    try {
                // Show skeleton loading state
                showSkeletonLoader();
                
        // Fetch a new ayah
                const response = await fetch(`${API_URL}?nocache=${Math.random()}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
        const data = await response.json();

        if (data && data.data && data.data.length >= 2) {
            const arabicVerse = data.data[0].text;
            const englishTranslation = data.data[1].text;
            const surah = data.data[0].surah.englishName;
            const ayahNumber = data.data[0].numberInSurah;
                    const surahNumber = data.data[0].surah.number;

                    // Store current verse data for sharing/favoriting
                    currentVerseData = {
                        arabic: arabicVerse,
                        english: englishTranslation,
                        surah: surah,
                        ayahNumber: ayahNumber,
                        surahNumber: surahNumber
                    };

            const ayahContent = 
                        `<div class="verse-header">
                            <span class="surah-info">Surah ${surah} (${surahNumber})</span>
                            <span class="ayah-number">Ayah ${ayahNumber}</span>
                        </div>
                        <p class="arabic-text">"${arabicVerse}"</p>
                        <p class="english-text">"${englishTranslation}"</p>`;

            // Display the new ayah
                    verseElement.innerHTML = ayahContent;

                    // Hide skeleton loader and show real content
                    hideSkeletonLoader();

                    // Update favorite button state
                    updateFavoriteButton();

            // Save the new ayah and the current timestamp to localStorage
                    localStorage.setItem(STORAGE_KEYS.SAVED_AYAH, JSON.stringify(ayahContent));
                    localStorage.setItem(STORAGE_KEYS.LAST_FETCHED_TIME, Date.now());
                    localStorage.setItem(STORAGE_KEYS.CURRENT_VERSE_DATA, JSON.stringify(currentVerseData));
        } else {
                    throw new Error('Invalid API response format');
        }
            } catch (error) {
                console.error('Error fetching verse:', error);
                
                // Hide skeleton loader
                hideSkeletonLoader();
                
                // Try to show cached verse if available, otherwise show error
                const storedAyah = localStorage.getItem(STORAGE_KEYS.SAVED_AYAH);
                if (storedAyah) {
                    verseElement.innerHTML = JSON.parse(storedAyah) + '<p><em style="color: #666; font-size: 12px;">(Showing cached verse - check your connection)</em></p>';
                } else {
                    verseElement.innerHTML = `<p><i class="fa-solid fa-exclamation-triangle"></i> Sorry, unable to load verse. Please check your internet connection and try again.</p>`;
                }
            }
}

        // Dark mode functionality
        function toggleDarkMode() {
            const isDarkMode = body.classList.toggle('dark-mode');
            const icon = darkModeToggle.querySelector('i');
            
            // Update icon based on current mode
            if (isDarkMode) {
                icon.className = 'fa-solid fa-sun';
                darkModeToggle.title = 'Switch to light mode';
        } else {
                icon.className = 'fa-solid fa-moon';
                darkModeToggle.title = 'Toggle dark mode';
            }
            
            // Save preference to localStorage
            localStorage.setItem(STORAGE_KEYS.DARK_MODE, isDarkMode);
        }

        function initializeDarkMode() {
            const savedDarkMode = localStorage.getItem(STORAGE_KEYS.DARK_MODE);
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            
            // Use saved preference or system preference
            const shouldUseDarkMode = savedDarkMode !== null ? 
                savedDarkMode === 'true' : prefersDark;
            
            if (shouldUseDarkMode) {
                body.classList.add('dark-mode');
                const icon = darkModeToggle.querySelector('i');
                icon.className = 'fa-solid fa-sun';
                darkModeToggle.title = 'Switch to light mode';
            }
        }

        // Icon cycling functionality
        function cycleIcon() {
            const currentIcon = localStorage.getItem(STORAGE_KEYS.SELECTED_ICON) || 'moon.png';
            const currentIndex = AVAILABLE_ICONS.indexOf(currentIcon);
            const nextIndex = (currentIndex + 1) % AVAILABLE_ICONS.length;
            const nextIcon = AVAILABLE_ICONS[nextIndex];
            
            // Update the icon
            moonIcon.src = nextIcon;
            
            // Save the new icon preference
            localStorage.setItem(STORAGE_KEYS.SELECTED_ICON, nextIcon);
            
            // Add a subtle animation
            moonIcon.style.transform = 'scale(1.1) rotate(360deg)';
            moonIcon.style.transition = 'transform 0.5s ease';
            
            setTimeout(() => {
                moonIcon.style.transform = 'scale(1) rotate(0deg)';
            }, 500);
        }

        function initializeIcon() {
            const savedIcon = localStorage.getItem(STORAGE_KEYS.SELECTED_ICON);
            if (savedIcon && AVAILABLE_ICONS.includes(savedIcon)) {
                moonIcon.src = savedIcon;
            }
        }

        // Skeleton loading functions
        function showSkeletonLoader() {
            verseElement.style.display = 'none';
            skeletonLoader.style.display = 'block';
        }

        function hideSkeletonLoader() {
            // Add a small delay to let users see the skeleton animation
            setTimeout(() => {
                skeletonLoader.style.display = 'none';
                verseElement.style.display = 'block';
                // Add a subtle fade-in effect for the real content
                verseElement.style.opacity = '0';
                verseElement.style.transform = 'translateY(10px)';
                verseElement.style.transition = 'opacity 0.3s ease, transform 0.3s ease';
                
                setTimeout(() => {
                    verseElement.style.opacity = '1';
                    verseElement.style.transform = 'translateY(0)';
                }, 50);
            }, 800); // Show skeleton for at least 800ms for better UX
        }


        // Extract verse data from cached content for sharing
        function extractVerseDataFromCachedContent() {
            try {
                const verseHeader = document.querySelector('.verse-header');
                const arabicText = document.querySelector('.arabic-text');
                const englishText = document.querySelector('.english-text');
                
                if (verseHeader && arabicText && englishText) {
                    const surahInfo = verseHeader.querySelector('.surah-info');
                    const ayahNumber = verseHeader.querySelector('.ayah-number');
                    
                    if (surahInfo && ayahNumber) {
                        // Extract surah name and number from "Surah Ar-Room (30)"
                        const surahMatch = surahInfo.textContent.match(/Surah (.+?) \((\d+)\)/);
                        const ayahMatch = ayahNumber.textContent.match(/Ayah (\d+)/);
                        
                        if (surahMatch && ayahMatch) {
                            currentVerseData = {
                                arabic: arabicText.textContent.replace(/"/g, ''),
                                english: englishText.textContent.replace(/"/g, ''),
                                surah: surahMatch[1],
                                ayahNumber: parseInt(ayahMatch[1]),
                                surahNumber: parseInt(surahMatch[2])
                            };
                            updateFavoriteButton();
                        }
                    }
        }
    } catch (error) {
                console.error('Error extracting verse data from cached content:', error);
            }
        }

        // Copy to clipboard functionality
        async function copyToClipboard() {
            if (!currentVerseData) return;
            
            const textToCopy = `"${currentVerseData.arabic}"\n\n"${currentVerseData.english}"\n\n— Surah ${currentVerseData.surah}, Ayah ${currentVerseData.ayahNumber}`;
            
            try {
                await navigator.clipboard.writeText(textToCopy);
                showNotification('Verse copied to clipboard!', 'success');
            } catch (err) {
                // Fallback for older browsers
                const textArea = document.createElement('textarea');
                textArea.value = textToCopy;
                document.body.appendChild(textArea);
                textArea.select();
                document.execCommand('copy');
                document.body.removeChild(textArea);
                showNotification('Verse copied to clipboard!', 'success');
            }
        }

        // Favorite functionality
        function toggleFavorite() {
            if (!currentVerseData) return;
            
            const favorites = JSON.parse(localStorage.getItem(STORAGE_KEYS.FAVORITES) || '[]');
            const verseId = `${currentVerseData.surahNumber}:${currentVerseData.ayahNumber}`;
            
            const existingIndex = favorites.findIndex(fav => fav.id === verseId);
            
            if (existingIndex > -1) {
                favorites.splice(existingIndex, 1);
                showNotification('Removed from favorites', 'info');
            } else {
                favorites.push({
                    id: verseId,
                    ...currentVerseData,
                    addedDate: new Date().toISOString()
                });
                showNotification('Added to favorites!', 'success');
            }
            
            localStorage.setItem(STORAGE_KEYS.FAVORITES, JSON.stringify(favorites));
            updateFavoriteButton();
        }

        function updateFavoriteButton() {
            if (!currentVerseData) return;
            
            const favorites = JSON.parse(localStorage.getItem(STORAGE_KEYS.FAVORITES) || '[]');
            const verseId = `${currentVerseData.surahNumber}:${currentVerseData.ayahNumber}`;
            const isFavorited = favorites.some(fav => fav.id === verseId);
            
            if (isFavorited) {
                favoriteButton.classList.add('favorited');
                favoriteButton.title = 'Remove from favorites';
            } else {
                favoriteButton.classList.remove('favorited');
                favoriteButton.title = 'Add to favorites';
            }
        }

        // Share functionality
        function toggleShareMenu() {
            if (shareMenu.style.display === 'none' || shareMenu.style.display === '') {
                shareMenu.style.display = 'block';
            } else {
                shareMenu.style.display = 'none';
            }
        }

        function shareToPlatform(platform) {
            if (!currentVerseData) {
                showNotification('No verse data available to share', 'error');
                return;
            }
            
            const text = `"${currentVerseData.arabic}"\n\n"${currentVerseData.english}"\n\n— Surah ${currentVerseData.surah}, Ayah ${currentVerseData.ayahNumber}`;
            const url = window.location.href;
            
            let shareUrl = '';
            
            switch (platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(text)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(text)}`;
                    break;
                case 'whatsapp':
                    shareUrl = `https://wa.me/?text=${encodeURIComponent(text + '\n\n' + url)}`;
                    break;
                case 'telegram':
                    shareUrl = `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(text)}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
                shareMenu.style.display = 'none';
                showNotification(`Opening ${platform}...`, 'info');
            } else {
                showNotification('Unable to share to this platform', 'error');
            }
        }

        // Notification system
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `notification ${type}`;
            notification.textContent = message;
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: ${type === 'success' ? '#27ae60' : type === 'error' ? '#e74c3c' : '#3498db'};
                color: white;
                padding: 12px 20px;
                border-radius: 8px;
                font-family: 'Lexend Deca', sans-serif;
                font-size: 14px;
                z-index: 10000;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
                transform: translateX(100%);
                transition: transform 0.3s ease;
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            // Remove after 3 seconds
            setTimeout(() => {
                notification.style.transform = 'translateX(100%)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // Touch gesture functions
        function handleTouchStart(e) {
            touchStartY = e.touches[0].clientY;
            isPulling = false;
            pullDistance = 0;
        }

        function handleTouchMove(e) {
            if (!touchStartY) return;
            
            touchEndY = e.touches[0].clientY;
            pullDistance = touchStartY - touchEndY;
            
            // Only trigger pull-to-refresh if user is at the top of the page
            if (window.scrollY === 0 && pullDistance < -50) {
                isPulling = true;
                e.preventDefault();
                
                // Add visual feedback
                const pullProgress = Math.min(Math.abs(pullDistance) / 100, 1);
                gridContainer.style.transform = `translateY(${Math.min(pullDistance + 50, 0)}px)`;
                gridContainer.style.opacity = 1 - (pullProgress * 0.3);
                
                // Show pull-to-refresh indicator
                if (!document.querySelector('.pull-indicator')) {
                    const indicator = document.createElement('div');
                    indicator.className = 'pull-indicator';
                    indicator.innerHTML = '<i class="fa-solid fa-arrow-down"></i> Pull to refresh';
                    indicator.style.cssText = `
                        position: fixed;
                        top: 20px;
                        left: 50%;
                        transform: translateX(-50%);
                        background: rgba(0,0,0,0.8);
                        color: white;
                        padding: 10px 20px;
                        border-radius: 20px;
                        font-size: 14px;
                        z-index: 1000;
                        transition: all 0.3s ease;
                        font-family: 'Lexend Deca', sans-serif;
                        backdrop-filter: blur(10px);
                        -webkit-backdrop-filter: blur(10px);
                    `;
                    document.body.appendChild(indicator);
                }
            }
        }

        function handleTouchEnd(e) {
            if (isPulling && pullDistance < -100) {
                // Trigger refresh
                fetchVerse(true);
                
                // Add refresh animation
                gridContainer.style.transform = 'translateY(0)';
                gridContainer.style.opacity = '1';
                gridContainer.style.transition = 'all 0.3s ease';
                
                // Remove pull indicator
                const indicator = document.querySelector('.pull-indicator');
                if (indicator) {
                    indicator.remove();
                }
            } else if (isPulling) {
                // Reset position
                gridContainer.style.transform = 'translateY(0)';
                gridContainer.style.opacity = '1';
                gridContainer.style.transition = 'all 0.3s ease';
                
                // Remove pull indicator
                const indicator = document.querySelector('.pull-indicator');
                if (indicator) {
                    indicator.remove();
                }
            }
            
            // Reset variables
            touchStartY = 0;
            touchEndY = 0;
            isPulling = false;
            pullDistance = 0;
        }

        // Add keyboard shortcuts
        document.addEventListener('keydown', function(event) {
            // Spacebar to refresh verse
            if (event.code === 'Space' && !event.target.matches('input, textarea')) {
                event.preventDefault();
                fetchVerse(true);
            }
            // D key to toggle dark mode
            if (event.code === 'KeyD' && !event.target.matches('input, textarea')) {
                event.preventDefault();
                toggleDarkMode();
            }
            // I key to cycle icon
            if (event.code === 'KeyI' && !event.target.matches('input, textarea')) {
                event.preventDefault();
                cycleIcon();
            }
            // C key to copy verse
            if (event.code === 'KeyC' && !event.target.matches('input, textarea')) {
                event.preventDefault();
                copyToClipboard();
            }
        });

        // Add click handler for refresh button with mobile feedback
        refreshButton.addEventListener('click', function() {
            // Add mobile tap animation
            if (window.innerWidth <= 768) {
                refreshButton.classList.add('mobile-tap');
                setTimeout(() => refreshButton.classList.remove('mobile-tap'), 200);
            }
            fetchVerse(true);
        });

        // Add click handler for dark mode toggle with mobile feedback
        darkModeToggle.addEventListener('click', function() {
            // Add mobile tap animation
            if (window.innerWidth <= 768) {
                darkModeToggle.classList.add('mobile-tap');
                setTimeout(() => darkModeToggle.classList.remove('mobile-tap'), 200);
            }
            toggleDarkMode();
        });

        // Add click handler for icon cycling
        moonIcon.addEventListener('click', function() {
            // Add mobile tap animation
            if (window.innerWidth <= 768) {
                moonIcon.classList.add('mobile-tap');
                setTimeout(() => moonIcon.classList.remove('mobile-tap'), 200);
            }
            cycleIcon();
        });

        // Add click handlers for action buttons
        copyButton.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                copyButton.classList.add('mobile-tap');
                setTimeout(() => copyButton.classList.remove('mobile-tap'), 200);
            }
            copyToClipboard();
        });

        favoriteButton.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                favoriteButton.classList.add('mobile-tap');
                setTimeout(() => favoriteButton.classList.remove('mobile-tap'), 200);
            }
            toggleFavorite();
        });

        shareButton.addEventListener('click', function() {
            if (window.innerWidth <= 768) {
                shareButton.classList.add('mobile-tap');
                setTimeout(() => shareButton.classList.remove('mobile-tap'), 200);
            }
            toggleShareMenu();
        });

        // Add click handlers for share options
        document.querySelectorAll('.share-option').forEach(option => {
            option.addEventListener('click', function() {
                const platform = this.getAttribute('data-platform');
                shareToPlatform(platform);
            });
        });

        // Close share menu when clicking outside
        document.addEventListener('click', function(event) {
            if (!shareButton.contains(event.target) && !shareMenu.contains(event.target)) {
                shareMenu.style.display = 'none';
            }
        });

        // Add touch event listeners for mobile gestures
        document.addEventListener('touchstart', handleTouchStart, { passive: false });
        document.addEventListener('touchmove', handleTouchMove, { passive: false });
        document.addEventListener('touchend', handleTouchEnd, { passive: false });

        // Initialize dark mode, icon, and fetch verse on page load
        initializeDarkMode();
        initializeIcon();
        fetchVerse();


    </script>
</body>
</html>
